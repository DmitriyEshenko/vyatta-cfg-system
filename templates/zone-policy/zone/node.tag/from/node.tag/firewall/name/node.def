type: txt
help: Set IPv4 firewall ruleset

allowed:
        local -a params ;
        params=( /opt/vyatta/config/active/firewall/name/* )
        echo -n ${params[@]##*/}

create:
        params=( `ls /opt/vyatta/config/active/firewall/name 2>/dev/null` )
        array_len=${#params[*]}
        i=0
        found=0
        while [ $i -lt $array_len ]; do
             if [ \"${params[$i]}\" == \"$VAR(@)\" ] ; then

                   found=1
             fi
             let i++
        done
        if [ $found -eq 0 ]; then
           echo Invalid IPv4 firewall ruleset [$VAR(@)]
           #exit 1
        fi

        /opt/vyatta/sbin/vyatta-zone.pl         \
          --action=add-fromzone-fw              \
          --zone-name="$VAR(../../../@)"        \
          --from-zone="$VAR(../../@)"           \
          --ruleset-type=name                   \
          --ruleset-name="$VAR(@)"

update:
        params=( `ls /opt/vyatta/config/active/firewall/name 2>/dev/null` )
        array_len=${#params[*]}
        i=0
        found=0
        while [ $i -lt $array_len ]; do
             if [ \"${params[$i]}\" == \"$VAR(@)\" ] ; then
                   found=1
             fi
             let i++
        done
        if [ $found -eq 0 ]; then
           echo Invalid IPv4 firewall ruleset [$VAR(@)]
           exit 1
        fi

        # need to undo previous ruleset here first
	old_ruleset=`cat /opt/vyatta/config/active/zone-policy/zone/$VAR(../../../@)/from/$VAR(../../@)/firewall/name/node.val`
        /opt/vyatta/sbin/vyatta-zone.pl         \
          --action=delete-fromzone-fw           \
          --zone-name="$VAR(../../../@)"        \
          --from-zone="$VAR(../../@)"           \
          --ruleset-type=name                   \
          --ruleset-name="$old_ruleset"

        /opt/vyatta/sbin/vyatta-zone.pl         \
          --action=add-fromzone-fw              \
          --zone-name="$VAR(../../../@)"        \
          --from-zone="$VAR(../../@)"           \
          --ruleset-type=name                   \
          --ruleset-name="$VAR(@)"

delete:
        /opt/vyatta/sbin/vyatta-zone.pl         \
          --action=delete-fromzone-fw           \
          --zone-name="$VAR(../../../@)"        \
          --from-zone="$VAR(../../@)"           \
          --ruleset-type=name                   \
          --ruleset-name="$VAR(@)"
